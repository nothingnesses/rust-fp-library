# Implementation Prompt for v0.1.0 Release

You are in the process of implementing the v0.1.0 release for the `fp-library` Rust functional programming library. Your task is to systematically remove the legacy v1 (curried) API and promote the v2 (uncurried) API to the crate root, resulting in a clean, single-standard library.

## Reference Documents

- **Release Plan**: `docs/v0.1.0-planning.md`
- **Release Checklist**: `docs/v0.1.0-checklist.md`
- **Previous Refactoring Plan** (for context): `docs/zero-cost-refactoring-plan.md`
- **Previous Refactoring Checklist** (for context): `docs/refactoring-checklist.md`
- **Parity Check** (for verification): `docs/parity-check.md`
- **Baseline Commit**: `78986ccf1285c5fcd003c846bcbe89c585e73228`

## Prerequisites Verification

Before starting, verify that these prerequisites are met:

1. **v2 implementation is complete**: All items in `docs/refactoring-checklist.md` should be marked complete (`[x]`).
2. **Tests pass**: Run `cargo test` and ensure all tests pass.
3. **Current version is 0.0.21+**: Check `fp-library/Cargo.toml` to confirm the version.

```bash
cargo test; grep "^version" fp-library/Cargo.toml
```

## Implementation Protocol (FOLLOW EACH OF THESE EXACTLY)

### 1. Progress Tracking

Before making changes and periodically during implementation, check your current progress against the baseline:

```bash
git diff 78986ccf1285c5fcd003c846bcbe89c585e73228; git -P log 78986ccf1285c5fcd003c846bcbe89c585e73228..HEAD
```

Use this to:

- Verify changes align with the plan
- Ensure no unintended modifications have occurred
- Track which files have been modified or deleted
- Review the sequence of commits made during the release process

After completing each step, update the checklist in `docs/v0.1.0-checklist.md` by marking the appropriate item as complete (`[x]`).

### 2. Execution Strategy (CRITICAL)

**This release involves DESTRUCTIVE changes** - you will be deleting the entire v1 API. Follow these principles:

1. **Complete each phase fully before moving to the next**. Partial completion may leave the codebase in an inconsistent state.
2. **Verify compilation after each major step** using `cargo check`.
3. **Run tests after completing each phase** using `cargo test`.
4. **Commit after each phase** to create restore points.

### 3. Per-Step Implementation Process

For **each step** in the release plan, follow this process:

#### 3.1. Analysis Phase

Before implementing, analyze the current step:

1. **Read the relevant source files** to understand the current state
2. **Identify dependencies** - what code depends on what you're changing or deleting?
3. **Consider edge cases** - are there imports, re-exports, or feature-flag guards that could cause issues?

#### 3.2. Review Gate

**STOP and present your findings to the user before implementing.** Include:

1. **Current state summary**: What files/code exist and their purpose
2. **Proposed changes**: What you plan to do
3. **Affected files**: List of files that will be modified or deleted
4. **Potential issues**: Any risks or concerns
5. **Questions**: Anything you need clarified before proceeding

Example format:

```markdown
## Phase X, Step Y: [Step Name]

### Current State

[Description of what exists]

### Proposed Changes

[What will be changed/deleted/moved]

### Affected Files

- `path/to/file1.rs` - [action: delete/modify/move]
- `path/to/file2.rs` - [action: delete/modify/move]

### Potential Issues

- [Issue 1]
- [Issue 2]

### Questions for Review

- [Question 1]

**Do you approve proceeding with this step?**
```

Wait for user approval before implementing.

#### 3.3. Implementation Phase

After approval:

1. **Implement the approved changes**
2. **Verify after each change** using `cargo check`
3. **Document any deviations** from the plan

#### 3.4. Verification Phase

After implementing each phase:

1. **Run verification suite**:
   ```bash
   cargo check; cargo test; cargo clippy
   ```
2. **Verify the diff**: `git diff`
3. **Update the checklist**: Mark the step as complete
4. **Formulate commit message**: Output a Markdown-formatted summary for the user to use in the git commit

If issues are found:

- Analyze the failure
- Propose fixes
- Get approval before applying fixes

### 4. Phase-by-Phase Guidance

#### Phase 1: Code Cleanup (Removal of v1)

**This is the most critical phase.** The order of steps matters.

##### Step 1.1: Extract Brand Definitions

The `fp-library/src/brands.rs` file currently re-exports brand structs from `crate::types::*`. Before deleting `types/`, you must make `brands.rs` self-contained.

**Actions:**
1. Read `fp-library/src/brands.rs` to see current re-exports
2. Read each file in `fp-library/src/types/*.rs` to find brand struct definitions
3. Copy the brand struct definitions (just the `pub struct XBrand;` lines) directly into `brands.rs`
4. Remove the `pub use crate::types::...` lines
5. Run `cargo check` to verify

**Brand structs to extract:**
- `ArcFnBrand`
- `EndofunctionBrand`
- `EndomorphismBrand`
- `IdentityBrand`
- `LazyBrand`
- `OnceCellBrand`
- `OnceLockBrand`
- `OptionBrand`
- `PairBrand`, `PairWithFirstBrand`, `PairWithSecondBrand`
- `RcFnBrand`
- `ResultBrand`, `ResultWithErrBrand`, `ResultWithOkBrand`
- `VecBrand`

##### Step 1.2: Remove Feature Flags

**Actions:**
1. Edit `fp-library/Cargo.toml`:
   - Remove `default = ["v1"]`
   - Remove `v1 = []`
   - Remove `v2 = []`
2. Edit `fp-library/src/lib.rs`:
   - Remove all `#[cfg(feature = "v1")]` guards
   - Remove all `#[cfg(feature = "v2")]` guards
   - Remove all `#[deprecated(...)]` attributes
   - Keep: `pub mod brands;`, `pub mod hkt;`, `pub mod macros;`, `pub mod v2;`
   - Remove: `pub mod classes;`, `pub mod functions;`, `pub mod types;` (but DON'T delete the files yet)
3. Run `cargo check` to verify

##### Step 1.3: Delete Legacy Modules

**Actions:**
1. Delete `fp-library/src/classes/` directory (entire directory)
2. Delete `fp-library/src/types/` directory (entire directory)
3. Delete `fp-library/src/functions.rs` file
4. Delete `fp-library/src/classes.rs` file (if it exists as a module file)
5. Delete `fp-library/src/types.rs` file (if it exists as a module file)
6. Run `cargo check` to verify

**IMPORTANT:** Ensure you do NOT delete `fp-library/src/v2/` - this contains the code being promoted.

#### Phase 2: Promotion of v2

##### Step 2.1: Move v2 to Root

**Actions:**
1. Move `fp-library/src/v2/classes/` to `fp-library/src/classes/`
2. Move `fp-library/src/v2/types/` to `fp-library/src/types/`
3. Move `fp-library/src/v2/functions.rs` to `fp-library/src/functions.rs`
4. Delete `fp-library/src/v2/mod.rs`
5. Delete `fp-library/src/v2/` directory (should be empty now)
6. Run `cargo check` - this will fail due to import paths; proceed to next step

##### Step 2.2: Update lib.rs

**Actions:**
1. Edit `fp-library/src/lib.rs`:
   - Add `pub mod classes;`
   - Add `pub mod types;`
   - Add `pub mod functions;`
   - Remove `pub mod v2;`
2. Run `cargo check` - this will still fail due to internal imports; proceed to Phase 3

#### Phase 3: Internal Refactoring

##### Step 3.1: Fix Internal Imports

**Actions:**
1. Search and replace across the codebase:
   - Replace `crate::v2::` with `crate::`
   - Replace `use crate::v2::` with `use crate::`
2. Check for broken `super::` imports in moved files
3. Run `cargo check` after each file modification

**Files likely needing updates:**
- All files in `fp-library/src/classes/*.rs`
- All files in `fp-library/src/types/*.rs`
- `fp-library/src/functions.rs`

##### Step 3.2: Verify String Implementation

**Actions:**
1. Open `fp-library/src/types/string.rs`
2. Verify it contains `impl Kind1L0T for String`
3. Verify there are no `#[cfg(...)]` feature guards
4. Run `cargo check` to verify

#### Phase 4: Verification and Documentation

##### Step 4.1: Run Full Test Suite

**Actions:**
```bash
cargo test
cargo test --doc
cargo clippy
```

Fix any failures before proceeding.

##### Step 4.2: Update Documentation

**Actions:**
1. Update `README.md`:
   - Remove references to "v2", "new API", "migration"
   - Update import paths (remove `::v2::`)
   - Update examples to use the new paths
2. Update `fp-library/src/lib.rs` crate-level documentation:
   - Remove migration notes
   - Remove v1/v2 comparison
   - Update module descriptions

#### Phase 5: Release

##### Step 5.1: Bump Version

**Actions:**
1. Edit `fp-library/Cargo.toml`:
   - Change `version = "0.0.22"` (or current) to `version = "0.1.0"`
2. Run `cargo check` to verify

##### Step 5.2: Final Verification

**Actions:**
```bash
cargo test
cargo test --doc
cargo clippy
cargo doc --open  # Verify documentation renders correctly
```

##### Step 5.3: Publish Preparation

Present to user:
```markdown
## Ready for Release

All steps complete. Please perform these final actions:

1. Review all changes against baseline: `git diff 78986ccf1285c5fcd003c846bcbe89c585e73228`
2. Review commit history: `git -P log 78986ccf1285c5fcd003c846bcbe89c585e73228..HEAD`
3. Commit any remaining changes
4. Tag the release: `git tag v0.1.0`
5. Push: `git push; git push --tags`
6. Publish: `cargo publish -p fp-library`
```

### 5. Handling Challenges

#### If cargo check fails

1. **Read the error carefully** - identify which file and line
2. **Check for leftover v2 references** - `grep -r "v2::" fp-library/src/`
3. **Check for missing imports** - the moved file may reference something not yet moved
4. **Document the issue** and propose a fix
5. **Get approval** before fixing

#### If tests fail

1. **Identify which test failed**
2. **Check if it's a v1 test** - these should have been deleted
3. **Check if it's a doc test** - fix the import path in the doc comment
4. **Document and propose fix**

#### If documentation references are broken

1. **Search for `fp_library::v2::`** in all doc comments
2. **Replace with `fp_library::`**
3. **Run `cargo test --doc`** to verify

### 6. Code Standards

#### Import Path Convention

After the release, all public paths should follow:
```rust
use fp_library::brands::OptionBrand;
use fp_library::classes::functor::map;
use fp_library::functions::compose;
use fp_library::types::option;  // for the impl imports
```

NOT:
```rust
use fp_library::v2::classes::functor::map;  // WRONG - v2 no longer exists
```

#### Documentation Updates

Ensure all doc tests use the new paths:
```rust
/// ```
/// use fp_library::classes::functor::map;
/// use fp_library::brands::OptionBrand;
/// 
/// assert_eq!(map::<OptionBrand, _, _, _>(|x: i32| x * 2, Some(5)), Some(10));
/// ```
```

### 7. Communication Guidelines

- **Be explicit** about what you're deleting - this is destructive
- **Show affected files** before each deletion step
- **Report progress** after each phase
- **Flag blockers** immediately

### 8. Success Criteria

The release is complete when:

1. All items in `docs/v0.1.0-checklist.md` are marked complete
2. `cargo test` passes with no failures
3. `cargo test --doc` passes with no failures
4. `cargo clippy` shows no warnings
5. No `v2` references remain in the codebase (except documentation explaining the history)
6. Version is set to `0.1.0` in `Cargo.toml`
7. All import paths use `fp_library::` not `fp_library::v2::`

---

## Getting Started

Begin with Phase 1, Step 1.1: Extract Brand Definitions. Read the current `fp-library/src/brands.rs` and the brand struct definitions in `fp-library/src/types/*.rs`, then present your analysis before proceeding.

Remember: **Always present your findings and get approval before implementing each step, especially for deletions.**
